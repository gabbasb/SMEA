# SMEA
Java Implementation of a secure message exchange application (SMEA).  
This application serves as a sample of client side encryption in Java for PostgreSQL.  
The messages are stored encrypted in PostgreSQL and the intended recipient can decrypt and read them.  
The application uses symmetric as well as asymmetric encryption.  
Messages are encrypted and decrypted using a secret key.  
a) The public keys of both Alice and Bob are stored in database.  
b) When Alice makes Bob her friend, Alice generates a secret key (SK).  
c) The secret key (SK) is encrypted using Alice’s public key. This (MEK_S) will be used for message encryption.  
d) The secret key (SK) is also encrypted using Bob’s public key. This (MEK_R) will be used for message decryption.  
e) When Alice wants to send message to Bob, she first decrypts MEK_S using her private key to get SK.  
f) She then encrypts message using SK and saves cipher text in the database.  
g) When Bob wants to read messages from Alice, he first decrypts MEK_R using his private key, to get SK.  
h) Bob then decrypts message sent by Alice using SK.  
  
The PostgreSQL schema is as follows:  
  
  CREATE SCHEMA smea;  
  CREATE TABLE smea.tbl_users(  
    u_id INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,  
    u_name varchar(255) NOT NULL UNIQUE,  
    u_public_key BYTEA NOT NULL);  
  CREATE TABLE smea.tbl_friends(  
    f_id INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,  
    f_from_u_id INT REFERENCES smea.tbl_users(u_id),  
    f_to_u_id INT REFERENCES smea.tbl_users(u_id),  
    f_mek_for_sending BYTEA NOT NULL,  
    f_mek_for_reading BYTEA NOT NULL,  
    UNIQUE (f_from_u_id, f_to_u_id));  
  CREATE TABLE smea.tbl_messages(  
    m_id INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,  
    m_f_id INT REFERENCES smea.tbl_friends(f_id),  
    m_message VARCHAR NOT NULL,  
    m_sent_on timestamp with time zone NOT NULL);  
  
  CREATE OR REPLACE FUNCTION smea.getSenderID(m_f_id integer)  
  RETURNS varchar AS $$  
  DECLARE uid VARCHAR(255);  
  BEGIN  
    SELECT u_id INTO uid FROM smea.tbl_users, smea.tbl_friends  
    WHERE f_id = m_f_id AND f_from_u_id = u_id;  
    RETURN uid;  
  END; $$  
  LANGUAGE PLPGSQL;  
  
  CREATE OR REPLACE FUNCTION smea.getSenderName(m_f_id integer)  
  RETURNS varchar AS $$  
  DECLARE uname VARCHAR(255);  
  BEGIN  
    SELECT u_name INTO uname FROM smea.tbl_users, smea.tbl_friends  
    WHERE f_id = m_f_id AND f_from_u_id = u_id;  
    RETURN uname;  
  END; $$  
  LANGUAGE PLPGSQL;  
  
Build Command:  
  mvn package  
  
Run Command:  
  java -cp target/SMEA-1.0-SNAPSHOT.jar:  
  /home/abbas/.m2/repository/junit/junit/3.8.1/junit-3.8.1.jar:  
  /home/abbas/.m2/repository/org/bouncycastle/bcpkix-jdk15on/1.64/bcpkix-jdk15on-1.64.jar:  
  /home/abbas/.m2/repository/org/bouncycastle/bcprov-jdk15on/1.64/bcprov-jdk15on-1.64.jar:  
  /home/abbas/.m2/repository/org/postgresql/postgresql/42.2.5/postgresql-42.2.5.jar  
  com.edb.smea.App add-user  
  
Commands supported by the application
  add-user
  add-friend
  send-messages
  read-messages
